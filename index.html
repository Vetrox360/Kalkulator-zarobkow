<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator zarobków</title>
    <link rel="icon" type="image/png" href="Logo.png">
  <style>
  
  .hours.day-off {
    background-color: #808080;
    color: #ffffff;
}
  
  #summarySection {
    margin-top: 20px;
}

#summarySection h2 {
    color: var(--accent-color);
    margin-bottom: 15px;
}

#summarySection .input-group {
    margin-bottom: 15px;
}

#summarySection label {
    display: block;
    margin-bottom: 5px;
    color: var(--accent-color);
}

#summarySection select,
#summarySection input[type="date"] {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 4px;
    background-color: var(--input-bg);
    color: var(--text-color);
    font-size: 16px;
  outline: 1px solid var(--accent-color);
}

#summarySection select:focus,
#summarySection input[type="date"]:focus {
    outline: 2px solid var(--accent-color);
}

#customDateRange {
    display: flex;
    justify-content: space-between;
}

#customDateRange .input-group {
    width: 48%;
}

#summaryResults {
    margin-top: 20px;
}

#summaryResults p {
    margin: 10px 0;
    font-size: 18px;
}

#summaryResults span {
    color: var(--accent-color);
    font-weight: bold;
}
  .calendar-day {
    background-color: var(--card-bg);
    border-radius: 4px;
    padding: 5px;
    text-align: center;
    position: relative; /* Add this */
    box-sizing: border-box; /* Add this */
}

.calendar-day.current-day {
    background-color: #2a2a2a; /* Slightly brighter gray */
}

.calendar-day.selected {
    box-shadow: inset 0 0 0 2px var(--accent-color);
}}}
 .calendar-day-label {
    font-weight: bold;
    text-align: center;
    padding: 5px;
    background-color: transparent;
    color: var(--text-color);
    border-radius: 4px;
}

.calendar-day-label.sunday {
    color: var(--accent-color);
}

.calendar-day.sunday {
    color: var(--accent-color);
}
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #fc4503;
            --input-bg: #1e1e1e;
            --card-bg: #1c1c1c;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 20px 70px;
            line-height: 1.6;
        }
        h1 {
            color: var(--text-color);
            text-align: center;
            margin-bottom: 30px;
        }
        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-color);
        }
        input, button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
        }
        input:focus{
            outline: 2px solid var(--accent-color);
        }
        button {
            background-color: var(--accent-color);
            color: var(--bg-color);
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #e63e00;
        }
        .result {
            font-size: 24px;
            margin-top: 10px;
        }
        .result span {
            color: var(--accent-color);
            font-weight: bold;
        }
        .big-number {
            font-size: 36px;
        }
        .small-decimals {
            font-size: 18px;
            vertical-align: super;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px;
        }
        .bottom-nav button {
            background-color: transparent;
            color: var(--text-color);
            border: none;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .bottom-nav button.active {
            color: var(--accent-color);
        }
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .calendar-day {
            background-color: var(--card-bg);
            border-radius: 4px;
            padding: 5px;
            text-align: center;
        }
        .calendar-day .hours {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border-radius: 10px;
            padding: 2px 5px;
            font-size: 12px;
            display: inline-block;
            margin-top: 5px;
        }
        #dayDetails {
            margin-top: 20px;
        }
   .month-picker {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .month-picker select, .month-picker input {
            margin: 0 5px;
            padding: 5px;
            border: 1px solid var(--accent-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
  .bottom-nav button {
    background-color: transparent;
    border: none;
    padding: 10px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
}
  
  .hours.day-off {
    background-color: #808080;
    color: #ffffff;
}
  

.nav-icon {
    width: 24px;
    height: 24px;
  filter: saturate(0%)
}

.bottom-nav button.active .nav-icon {
    filter: saturate(100%)
}
  :root {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --accent-color: #fc4503;
    --input-bg: #1e1e1e;
    --card-bg: #1c1c1c;
}

body.light-mode {
    --bg-color: #f0f0f0;
    --text-color: #333333;
    --accent-color: #fc4503;
    --input-bg: #ffffff;
    --card-bg: #ffffff;
}
  .month-picker {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}
  
.month-arrow {
    background-color: rgba(00, 00, 00, 00);
       color: var(--accent-color);
    font-size: 16px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
  margin: 0 5px
}

.month-arrow:active {
    background-color: rgba(00, 00, 00, 00);
       color: var(--accent-color);
}
  .month-arrow:hover {
    background-color: rgba(00, 00, 00, 00);
       color: var(--accent-color);
}
  
.month-arrow:focus {
    outline: none;
}

#calendar {
    transition: opacity 0.3s ease-in-out;
}

.fade-out {
    opacity: 0;
}

.fade-in {
    opacity: 1;
}
    </style>
</head>
<body>
    <div id="mainPage">
        <h1>Kalkulator zarobków</h1>
        
      <div class="card">
          <div class="result">Zarobki:</div>
            <div class="result"><span id="earnings"></span> EUR</div>
            <div class="result"><span id="earningsPLN"></span> PLN</div>
            <div class="result">Godziny: <span id="hoursWorked">0.00</span></div>
        <br> <div class="month-picker">
  <button id="mainYearDown" class="month-arrow">&#9660;</button>
  <input type="number" id="mainYearInput" value="2025" min="2000" max="2100" style="width: 80px;" readonly>
  <button id="mainYearUp" class="month-arrow">&#9650;</button>
</div> </div>
      
        <div class="card">
            <div class="input-group">
                <label for="startTime">Godzina rozpoczęcia pracy:</label>
                <input type="time" id="startTime">
            </div>
            <div class="input-group">
                <label for="endTime">Godzina zakończenia pracy:</label>
                <input type="time" id="endTime">
            </div>
            <button onclick="updateWorkTime()">Aktualizuj czas pracy</button>
            <button onclick="resetHours()">Resetuj godziny</button>
        </div>
    </div>

    <div id="calendarPage" style="display: none;">
        <h1>Kalendarz pracy</h1>
        
        <!-- Month picker elements -->
        <div class="month-picker">
    <button id="prevMonth" class="month-arrow">&#9650;</button>
    <select id="monthSelect" onchange="updateCalendar()"><option value="0">Styczeń</option>
                <option value="1">Luty</option>
                <option value="2">Marzec</option>
                <option value="3">Kwiecień</option>
                <option value="4">Maj</option>
                <option value="5">Czerwiec</option>
                <option value="6">Lipiec</option>
                <option value="7">Sierpień</option>
                <option value="8">Wrzesień</option>
                <option value="9">Październik</option>
                <option value="10">Listopad</option>
                <option value="11">Grudzień</option>
            </select>
    <button id="nextMonth" class="month-arrow">&#9660;</button>
    <input type="number" id="yearInput" value="2024" min="2000" max="2100" onchange="updateCalendar()">
</div>
      
<div id="calendar">
  </div>

<div id="dayDetails" class="card"></div>

<div id="summarySection" class="card">
        <h2>Podsumowanie</h2>
        <div class="input-group">
            <label for="summaryPeriod">Okres:</label>
            <select id="summaryPeriod" onchange="updateSummary()">
                <option>Wybierz okres</option>
              <option value="year">Ten rok</option>
                <option value="month">Ten miesiąc</option>
                <option value="week">Ten tydzień</option>
                <option value="custom">Niestandardowy</option>
            </select>
        </div>
        <div id="customDateRange" style="display: none;">
            <div class="input-group">
                <label for="customStartDate">Od:</label>
                <input type="date" id="customStartDate" onchange="updateSummary()">
            </div>
            <div class="input-group">
                <label for="customEndDate">Do:</label>
                <input type="date" id="customEndDate" onchange="updateSummary()">
            </div>
        </div>
        <div id="summaryResults">
            <p>Całkowite godziny: <span id="totalHours">0.00</span></p>
            <p>Zarobki: <span id="totalEarnings">0.00</span> EUR</p>
            <p>Zarobki: <span id="totalEarningsPLN">0.00</span> PLN</p>
        </div>
    </div>
      <button onclick="exportToCSV()">Exportuj dane do CSV</button>
</div>
    

<div id="settingsPage" style="display: none;">
    <h1>Settings</h1>
    <div class="input-group">
        <label for="themeToggle">Theme:</label>
        <button id="themeToggle" onclick="toggleTheme()">Toggle Light/Dark Mode</button>
    </div>
    <button onclick="backupData()">Backup Data</button>
    <button onclick="restoreData()">Restore Data</button>
    <input type="file" id="restoreFile" style="display: none;" onchange="handleFileUpload(event)">
    <button id="authButton" onclick="handleAuthClick()">Authorize Google Drive</button>
    <button onclick="backupToGDrive()" id="gdriveBackupButton" style="display: none;">Backup to Google Drive</button>
    <button onclick="restoreFromGDrive()" id="gdriveRestoreButton" style="display: none;">Restore from Google Drive</button>
</div>
  
  <div class="bottom-nav">
    <button onclick="showPage('mainPage')" id="mainPageBtn">
        <img src="Home.webp" alt="Home" class="nav-icon">
    </button>
    <button onclick="showPage('calendarPage')" id="calendarPageBtn">
        <img src="Calendar.webp" alt="Calendar" class="nav-icon">
    </button>
    <button onclick="showPage('settingsPage')" id="settingsPageBtn">
        <img src="Settings.webp" alt="Settings" class="nav-icon">
    </button>
</div>
  
  <script>
    const HOURLY_RATE = 11.17;
    const PLN_RATE = 4.30;
    let workData = {};
    let intervalId;

  function backupData() {
    const data = JSON.stringify(workData);
    const blob = new Blob([data], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'work_data_backup.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function restoreData() {
    document.getElementById('restoreFile').click();
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            workData = JSON.parse(e.target.result);
            saveData();
            loadData();
            alert('Data restored successfully!');
        } catch (error) {
            alert('Error restoring data. Please ensure you selected a valid backup file.');
        }
    };
    reader.readAsText(file);
}

// Google Drive API functions (these are just skeletons, youll need to implement the full logic)
let isAuthorized = false;

function handleAuthClick() {
    if (!isAuthorized) {
        // Implement Google OAuth here
        // When authorized, set isAuthorized to true and show the Google Drive buttons
        isAuthorized = true;
        document.getElementById('gdriveBackupButton').style.display = 'inline-block';
        document.getElementById('gdriveRestoreButton').style.display = 'inline-block';
    }
}

function backupToGDrive() {
    if (isAuthorized) {
        // Implement backup to Google Drive here
        console.log('Backing up to Google Drive...');
    } else {
        alert('Please authorize access to Google Drive first.');
    }
}

function restoreFromGDrive() {
    if (isAuthorized) {
        // Implement restore from Google Drive here
        console.log('Restoring from Google Drive...');
    } else {
        alert('Please authorize access to Google Drive first.');
    }
}
  
  
    function loadData() {
        workData = JSON.parse(localStorage.getItem('workData') || '{}');
        updateEarnings();
        renderCalendar();
    }

    function saveData() {
        localStorage.setItem('workData', JSON.stringify(workData));
    }

    function updateWorkTime() {
        const date = new Date().toISOString().split('T')[0];
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        if (startTime && endTime) {
            workData[date] = { startTime, endTime };
            saveData();
            updateEarnings();
            renderCalendar();
        }
    }

    function resetHours() {
        if (confirm('Czy na pewno chcesz zresetować godziny?')) {
            const date = new Date().toISOString().split('T')[0];
            delete workData[date];
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
            saveData();
            updateEarnings();
            renderCalendar();
        }
    }

    function formatMoney(amount) {
        const [wholePart, decimalPart] = amount.toFixed(5).split('.');
        return `<span class="big-number">${wholePart}.${decimalPart.slice(0,2)}</span><span class="small-decimals">${decimalPart.slice(2)}</span>`;
    }
  
  function getSelectedMainYear() {
  const input = document.getElementById("mainYearInput");
  const year = parseInt(input?.value, 10);
  return isNaN(year) ? new Date().getFullYear() : year;
}

    function updateEarnings() {
  clearInterval(intervalId);
  intervalId = setInterval(() => {
    let totalHours = 0;
    const now = new Date();
    const today = now.toISOString().split('T')[0];

    const selectedYear = getSelectedMainYear();

for (const [date, data] of Object.entries(workData)) {
  const year = new Date(date).getFullYear();
  if (year !== selectedYear) continue;

  const start = new Date(date + 'T' + data.startTime);
  const end = new Date(date + 'T' + data.endTime);
  if (end < start) end.setDate(end.getDate() + 1);

  if (date === today) {
    totalHours += (Math.min(now, end) - start) / 3600000;
  } else {
    totalHours += (end - start) / 3600000;
  }
}
 

    const earnings = totalHours * HOURLY_RATE;
    const earningsPLN = earnings * PLN_RATE;

    document.getElementById('earnings').innerHTML = formatMoney(earnings);
    document.getElementById('earningsPLN').innerHTML = formatMoney(earningsPLN);
    document.getElementById('hoursWorked').textContent = totalHours.toFixed(2);

    // Update allHours element
    document.getElementById('allHours').textContent = totalHours.toFixed(2);

  }, 50);
}

  function updateSummary() {
    const period = document.getElementById('summaryPeriod').value;
    const customDateRange = document.getElementById('customDateRange');
    
    if (period === 'custom') {
        customDateRange.style.display = 'block';
    } else {
        customDateRange.style.display = 'none';
    }

    let startDate, endDate;
    const now = new Date();

    switch (period) {
        case 'year':
            startDate = new Date(now.getFullYear(), 0, 1);
            endDate = new Date(now.getFullYear(), 11, 31);
            break;
        case 'month':
            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            break;
        case 'week':
            startDate = new Date(now.setDate(now.getDate() - now.getDay()));
            endDate = new Date(now.setDate(now.getDate() - now.getDay() + 6));
            break;
        case 'custom':
            startDate = new Date(document.getElementById('customStartDate').value);
            endDate = new Date(document.getElementById('customEndDate').value);
            break;
    }

    calculateSummary(startDate, endDate);
}

function calculateSummary(startDate, endDate) {
    let totalHours = 0;
    let totalEarnings = 0;

    for (const [date, data] of Object.entries(workData)) {
        const workDate = new Date(date);
        if (workDate >= startDate && workDate <= endDate) {
            const start = new Date(`${date}T${data.startTime}`);
            const end = new Date(`${date}T${data.endTime}`);
            if (end < start) end.setDate(end.getDate() + 1);
            const hours = (end - start) / 3600000;
            totalHours += hours;
            totalEarnings += hours * HOURLY_RATE;
        }
    }

    document.getElementById('totalHours').textContent = totalHours.toFixed(2);
    document.getElementById('totalEarnings').textContent = totalEarnings.toFixed(2);
    document.getElementById('totalEarningsPLN').textContent = (totalEarnings * PLN_RATE).toFixed(2);
}

    function updateCalendar() {
            renderCalendar();
      updateSummary();
        }

        function renderCalendar() {
    const calendarEl = document.getElementById('calendar');
    const monthSelect = document.getElementById('monthSelect');
    const yearInput = document.getElementById('yearInput');
    const selectedMonth = parseInt(monthSelect.value, 10);
    const selectedYear = parseInt(yearInput.value, 10);

    calendarEl.innerHTML = '';
    const firstDay = new Date(selectedYear, selectedMonth, 1);
    const lastDay = new Date(selectedYear, selectedMonth + 1, 0);

    // Add day labels
    const dayLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    dayLabels.forEach((day, index) => {
        const dayLabel = document.createElement('div');
        dayLabel.className = 'calendar-day-label';
        if (index === 6) {
            dayLabel.classList.add('sunday');
        }
        dayLabel.textContent = day;
        calendarEl.appendChild(dayLabel);
    });

    // Calculate the number of empty cells before the first day of the month
    let firstDayOfWeek = firstDay.getDay() - 1;
    if (firstDayOfWeek === -1) firstDayOfWeek = 6; // Sunday should be 6 when starting from Monday

    for (let i = 0; i < firstDayOfWeek; i++) {
        calendarEl.appendChild(document.createElement('div'));
    }

    for (let d = 1; d <= lastDay.getDate(); d++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        
        // Check if it is a Sunday
        const currentDate = new Date(selectedYear, selectedMonth, d);
        if (currentDate.getDay() === 0) {
            dayEl.classList.add('sunday');
        }
        
        dayEl.textContent = d;

        const date = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        if (workData[date]) {
            if (workData[date].isDayOff) {
                const hoursEl = document.createElement('div');
                hoursEl.className = 'hours day-off';
                hoursEl.textContent = '0';
                dayEl.appendChild(hoursEl);
            } else {
                const start = new Date(`${date}T${workData[date].startTime}`);
                const end = new Date(`${date}T${workData[date].endTime}`);
                if (end < start) end.setDate(end.getDate() + 1);
                const hours = (end - start) / 3600000;
                const hoursDisplay = hours % 1 === 0 ? `${Math.floor(hours)}h` : `${hours.toFixed(1)}h`;
                const hoursEl = document.createElement('div');
                hoursEl.className = 'hours';
                hoursEl.textContent = hoursDisplay;
                dayEl.appendChild(hoursEl);
            }
        }

        dayEl.onclick = () => showDayDetails(date);
        calendarEl.appendChild(dayEl);
    }
}

function showDayDetails(date) {
    // Remove the selected class from any previously selected date
    const previouslySelected = document.querySelector('.calendar-day.selected');
    if (previouslySelected) {
        previouslySelected.classList.remove('selected');
    }

    // Add the selected class to the clicked date
    const dayElements = document.querySelectorAll('.calendar-day');
    const dayNumber = parseInt(date.split('-')[2], 10); // Convert to number
    dayElements.forEach(dayEl => {
        const dayText = parseInt(dayEl.childNodes[0].nodeValue.trim(), 10); // Convert to number
        if (dayText === dayNumber) {
            dayEl.classList.add('selected');
        }
    });

    const detailsEl = document.getElementById('dayDetails');
    if (workData[date]) {
        const { startTime, endTime } = workData[date];
        const workDate = new Date(date);
        const weekdays = ['Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'];
        const weekday = weekdays[workDate.getDay()];
        const start = new Date(`${date}T${startTime}`);
        const end = new Date(`${date}T${endTime}`);
        if (end < start) end.setDate(end.getDate() + 1);
        const hours = ((end - start) / 3600000).toFixed(2);

        detailsEl.innerHTML = `
            <h2>${date}</h2>
            <p>Start: ${startTime}</p>
            <p>Koniec: ${endTime}</p>
            <button onclick="editWorkDay('${date}')">Edytuj</button>
            <button onclick="copyDayInfoAsText('${date}', '${weekday}', '${startTime}', '${endTime}', ${hours})">Kopiuj jako tekst</button>
        `;
    } else {
        detailsEl.innerHTML = `
            <h2>${date}</h2>
            <p>Brak danych o pracy</p>
            <button onclick="addWorkDay('${date}')">Dodaj godziny pracy</button>
      <button onclick="setDayOff('${date}')">Dzień wolny</button>
        `;
    }
}
  
  function setDayOff(date) {
    workData[date] = { startTime: '00:00', endTime: '00:00', isDayOff: true };
    saveData();
    updateEarnings();
    renderCalendar();
    showDayDetails(date);
}
  
  function copyDayInfoAsText(date, weekday, startTime, endTime, hours) {
    const formattedText = `${date} ${weekday}: od ${startTime} do ${endTime} - ${Math.floor(hours)} Godzin`;
    
    navigator.clipboard.writeText(formattedText).then(() => {
        alert('Skopiowano do schowka!');
    }).catch(err => {
        console.error('Nie udało się skopiować tekstu: ', err);
    });
}
  

    function editWorkDay(date) {
        const { startTime, endTime } = workData[date];
        const detailsEl = document.getElementById('dayDetails');
        detailsEl.innerHTML = `
            <h2>${date}</h2>
            <div class="input-group">
                <label for="editStartTime">Start:</label>
                <input type="time" id="editStartTime" value="${startTime}">
            </div>
            <div class="input-group">
                <label for="editEndTime">Koniec:</label>
                <input type="time" id="editEndTime" value="${endTime}">
            </div>
            <button onclick="saveWorkDay('${date}')">Zapisz</button>
        `;
    }

    function addWorkDay(date) {
        const detailsEl = document.getElementById('dayDetails');
        detailsEl.innerHTML = `
            <h2>${date}</h2>
            <div class="input-group">
                <label for="editStartTime">Start:</label>
                <input type="time" id="editStartTime">
            </div>
            <div class="input-group">
                <label for="editEndTime">Koniec:</label>
                <input type="time" id="editEndTime">
            </div>
            <button onclick="saveWorkDay('${date}')">Zapisz</button>
        `;
    }

    function saveWorkDay(date) {
        const startTime = document.getElementById('editStartTime').value;
        const endTime = document.getElementById('editEndTime').value;
        if (startTime && endTime) {
            workData[date] = { startTime, endTime };
            saveData();
            updateEarnings();
            renderCalendar();
            showDayDetails(date);
        }
    }
  
  
function showPage(pageId) {
    document.getElementById('mainPage').style.display = pageId === 'mainPage' ? 'block' : 'none';
    document.getElementById('calendarPage').style.display = pageId === 'calendarPage' ? 'block' : 'none';
    document.getElementById('settingsPage').style.display = pageId === 'settingsPage' ? 'block' : 'none';
    
    document.getElementById('mainPageBtn').classList.toggle('active', pageId === 'mainPage');
    document.getElementById('calendarPageBtn').classList.toggle('active', pageId === 'calendarPage');
    document.getElementById('settingsPageBtn').classList.toggle('active', pageId === 'settingsPage');
  
}
  

function updateCalendar() {
    const now = new Date();
    const monthSelect = document.getElementById('monthSelect');
    const yearInput = document.getElementById('yearInput');
    
    // Always use the current month and year when the function is called without user input
    const selectedMonth = monthSelect.dataset.userSelected ? parseInt(monthSelect.value, 10) : now.getMonth();
    const selectedYear = yearInput.dataset.userSelected ? parseInt(yearInput.value, 10) : now.getFullYear();

    // Update month select and year input values
    monthSelect.value = selectedMonth;
    yearInput.value = selectedYear;

    // Reset the userSelected flag
    monthSelect.dataset.userSelected = 'false';
    yearInput.dataset.userSelected = 'false';

    renderCalendar();

    // Select current day
    const todayString = now.toISOString().split('T')[0];
    showDayDetails(todayString);
}

function toggleTheme() {
    document.body.classList.toggle('light-mode');
    saveThemePreference();
}

function saveThemePreference() {
    const isLightMode = document.body.classList.contains('light-mode');
    localStorage.setItem('lightMode', isLightMode);
}

function loadThemePreference() {
    const isLightMode = localStorage.getItem('lightMode') === 'true';
    if (isLightMode) {
        document.body.classList.add('light-mode');
    }
}

// Add this to the existing window.onload function
window.onload = () => {
    loadData();
    updateCalendar();
    showPage('mainPage');
    loadThemePreference(); // Add this line
};

// Modify these event listeners to set a flag when user changes the value
document.getElementById('monthSelect').onchange = function() {
    this.dataset.userSelected = 'true';
    updateCalendar();
};
document.getElementById('yearInput').onchange = function() {
    this.dataset.userSelected = 'true';
    updateCalendar();
};
  document.getElementById('customStartDate').addEventListener('change', updateSummary);
document.getElementById('customEndDate').addEventListener('change', updateSummary);

  function exportToCSV() {
    let csvContent = "data:text/csv;charset=utf-8,Date,Work Start,Work End,Hours Worked\n";
    
    for (const [date, data] of Object.entries(workData)) {
        const start = new Date(`${date}T${data.startTime}`);
        const end = new Date(`${date}T${data.endTime}`);
        if (end < start) end.setDate(end.getDate() + 1);
        const hoursWorked = (end - start) / 3600000;

        csvContent += `${date},${data.startTime},${data.endTime},${hoursWorked.toFixed(2)}\n`;
    }

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "work_data.csv");
    document.body.appendChild(link); // Required for Firefox
    link.click();
    document.body.removeChild(link); // Clean up after download
}
  
  function changeMonth(delta) {
    const monthSelect = document.getElementById('monthSelect');
    const yearInput = document.getElementById('yearInput');
    let month = parseInt(monthSelect.value);
    let year = parseInt(yearInput.value);

    month += delta;
    if (month < 0) {
        month = 11;
        year--;
    } else if (month > 11) {
        month = 0;
        year++;
    }

    monthSelect.value = month;
    yearInput.value = year;
    animateCalendarChange();
}

function animateCalendarChange() {
    const calendar = document.getElementById('calendar');
    calendar.classList.add('fade-out');
    setTimeout(() => {
        updateCalendar();
        calendar.classList.remove('fade-out');
        calendar.classList.add('fade-in');
        setTimeout(() => {
            calendar.classList.remove('fade-in');
        }, 300);
    }, 300);
}

document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));

 document.getElementById('mainYearUp').addEventListener('click', () => {
  const yearInput = document.getElementById('mainYearInput');
  yearInput.value = Math.min(2100, parseInt(yearInput.value) + 1);
  updateEarnings();
});

document.getElementById('mainYearDown').addEventListener('click', () => {
  const yearInput = document.getElementById('mainYearInput');
  yearInput.value = Math.max(2000, parseInt(yearInput.value) - 1);
  updateEarnings();
});
 
 </script>
</body>
</html>
